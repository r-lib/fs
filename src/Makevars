# Use C++11 if available, so we have C99 support for variadic macros
CXX_STD=CXX11

PKG_LIBS = ./libuv/.libs/libuv.a `pkg-config libbsd --libs 2>/dev/null`

PKG_CPPFLAGS = -I./libuv/include

$(SHLIB): libuv/.libs/libuv.a

ifdef _R_CHECK_COMPILATION_FLAGS_
    CONFIGURE_FLAGS="--quiet"
endif
libuv/Makefile:
	(cd libuv && sh autogen.sh && ./configure $(CONFIGURE_FLAGS))

libuv/.libs/libuv.a: libuv/Makefile
	$(MAKE) --directory=libuv \
		CC="$(CC)" CFLAGS="$(CFLAGS) $(CPICFLAGS) $(C_VISIBILITY)" AR="$(AR)" RANLIB="$(RANLIB)" \
		HAVE_DTRACE=0

clean:
	$(MAKE) --directory=libuv distclean
